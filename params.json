{"name":"Es2unix","tagline":"shell for quick operations with ES using terminal","body":"# es2unix\r\n\r\nElasticsearch API consumable by the command line.\r\n\r\nJSON isn't always the most convenient output, particularly on a\r\nterminal.  The tabular format has stuck around for good reason.  It's\r\ncompact.  It's line-oriented.  es2unix strives to keep spaces\r\nsignificant so all output works with existing *NIX tools.  `grep`,\r\n`sort`, & `awk` are first-class citizens here.\r\n\r\n\r\n# Install\r\n\r\nes2unix's only dependency is Java (Oracle or OpenJDK).  Version 7\r\nshould be preferred, but there is no functional difference with 6.\r\nEarlier versions aren't supported.\r\n\r\n        curl -s download.elasticsearch.org/es2unix/es >~/bin/es\r\n        chmod +x ~/bin/es\r\n\r\nYou can also pin to a particular version from your provisioning tools.\r\n\r\n        curl -s download.elasticsearch.org/es2unix/es-20130503595fce2 >~/bin/es\r\n\r\n# Usage\r\n\r\nThe `es` command takes subcommands and a few options.  It assumes it's\r\ntalking to ES at its default HTTP port using `http://localhost:9200`\r\nbut accepts `-u` to change that.  It must be a fully qualifed URL with\r\nscheme, host, & port.\r\n\r\nYou can also supply `-v`, for most commands, to print a column header.\r\n\r\n\r\n## Version\r\n\r\n        % es version\r\n        es            1.0.0\r\n        elasticsearch 0.21.0.Beta1\r\n\r\n\r\n## Health\r\n\r\n        % es health -v\r\n        cluster status nodes data pri shards relo init unassign\r\n        kluster green      2    2   3      6    0    0        0\r\n\r\n## Count\r\n\r\nSometimes you need a quick count to tell whether a cluster has any\r\ndata and whether it's indexing.  You can also supply a query.\r\n\r\n        % es count\r\n        2,319,799\r\n        % es count elasticsearch\r\n        3 \"q=elasticsearch\"\r\n        % es count \"john deacon\"\r\n        225,839 \"q=john deacon\"\r\n        % es count \"\\\"saved by the bell\\\"\"\r\n        220 \"q=\"saved by the bell\"\"\r\n\r\n## Search\r\n\r\nNot exhaustive access to the query API by any stretch, but it suffices\r\nwhen you need to get a glance of the data in your cluster.  Searches\r\nacross indices with a default query of `*:*`.\r\n\r\n        % es search\r\n        1.0     wiki    page 1228929\r\n        1.0     wiki    page 1229142\r\n        1.0     wiki    page 1229146\r\n        1.0     wiki    page 1229153\r\n        1.0     wiki    page 1228943\r\n        1.0     wiki    page 1229155\r\n        1.0     wiki    page 1228950\r\n        1.0     wiki    page 1229159\r\n        1.0     wiki    page 1228956\r\n        1.0     wiki    page 1229160\r\n         Total: 2319799\r\n\r\nCan also specify a query, like `es search \\\"george costanza\\\"`, and,\r\npossibly more interestingly, a list of fields to return.\r\n\r\n        % es search -v \"george costanza\" title\r\n        score   index  type id      title\r\n        5.78647 wiki   page 660183  George Costansa\r\n        5.78647 wiki   page 273868  George Constanza\r\n        5.63803 wiki   page 865781  Vandelay Industries\r\n        4.69835 wiki   page 932333  Art Vandelay\r\n        4.69835 wiki   page 2147975 Can't Stand Ya\r\n        4.67351 wiki   page 2486208 Art vandelay\r\n        4.07630 wiki   page 2147959 Costanza\r\n        3.23200 wiki   page 2147971 The Costanza family\r\n        3.21007 wiki   page 2147972 Costanza family\r\n        2.94863 wiki   page 4946953 Santa costanza\r\n         Total: 118186\r\n\r\n## Master\r\n\r\n        % es master\r\n        J-erllamTOiW5WoGVUd04A 127.0.0.1 Slade, Frederick\r\n\r\n\r\n## Indices\r\n\r\n        % es indices -v\r\n        status name   pri rep    docs        size\r\n        green  _river   0   1       4        8068\r\n        green  wiki     1   1 1104894 13805525784\r\n\r\nMaybe your cluster is red and you need to know which indices are\r\naffected:\r\n\r\n        % es indices | grep \\^red\r\n        red    bb           5 0\r\n        red    test         4 1   218b   218  0\r\n        red    enron        5 0\r\n        red    uno          1 0\r\n\r\n## Allocation\r\nDisplays shard allocation counts across nodes\r\n\r\n        % es allocation -v\r\n        count ip           name\r\n           12 192.168.0.24 Sage\r\n           30 x.x.x.x      UNASSIGNED\r\n\r\n## Nodes\r\n\r\nWhat HTTP port is `Cannonball I` listening on?  Who's the master?\r\nWho's master-eligible?  Who's got `data=true`?\r\n\r\n        % es nodes\r\n        Uv1Iy8FvR0y6_RzPXKBolg 127.0.0.1 9201 127.0.0.1 9300   d Cannonball I\r\n        J-erllamTOiW5WoGVUd04A 127.0.0.1 9200 127.0.0.1 9301 * d Slade, Frederick\r\n        j27iagsmQQaeIpl6yU6mCg 127.0.0.1 9203 127.0.0.1 9303 - c Georgianna Castleberry\r\n        T1aFDU2BSUm748gYxjEN9w 127.0.0.1 9202 127.0.0.1 9302   d Living Tribunal\r\n\r\nIf you have access to logs from all the nodes, you can run `lifecycle`\r\nto get a playback of all the node joinings and leavings with their\r\ntimestamps ordered sequentially.  This is much faster than combing the\r\nlogs and piecing together the sequence manually.\r\n\r\n        % es lifecycle /tmp/es-*/logs/elasticsearch.log\r\n        2013-02-08 13:47:15,516 Lurking Unknown INIT   0.21.0.Beta1-SNAPSHOT\r\n        2013-02-08 13:47:20,413 Lurking Unknown MASTER Lurking Unknown\r\n        2013-02-08 13:47:20,467 Lurking Unknown START\r\n        2013-02-08 13:47:36,319 Cameron Hodge   INIT   0.21.0.Beta1-SNAPSHOT\r\n        2013-02-08 13:47:41,211 Lurking Unknown ADD    Cameron Hodge\r\n        2013-02-08 13:47:41,223 Cameron Hodge   MASTER Lurking Unknown\r\n        2013-02-08 13:47:41,278 Cameron Hodge   START\r\n        2013-02-08 13:47:59,426 Armageddon      INIT   0.21.0.Beta1-SNAPSHOT\r\n        2013-02-08 13:48:04,279 Lurking Unknown ADD    Armageddon\r\n        2013-02-08 13:48:04,280 Cameron Hodge   ADD    Armageddon\r\n        2013-02-08 13:48:04,287 Armageddon      MASTER Lurking Unknown\r\n        2013-02-08 13:48:04,340 Armageddon      START\r\n        2013-02-08 13:48:30,333 Lurking Unknown REMOVE Armageddon\r\n        2013-02-08 13:48:30,339 Cameron Hodge   REMOVE Armageddon\r\n        2013-02-08 13:48:30,362 Armageddon      STOP\r\n\r\n## Heap\r\n\r\nHeap across the cluster.\r\n\r\n        % es heap | sort -rnk6\r\n        XO6c2A1D 23.9mb 25138608 123.7mb  129761280 19.4% 127.0.0.1 Junkpile\r\n        uVP8g9_l 94.6mb 99257976 990.7mb 1038876672  9.6% 127.0.0.1 Hammond, Jim\r\n        pjbeg_k8 76.9mb 80730208 990.7mb 1038876672  7.8% 127.0.0.1 Scarlet Centurion\r\n\r\nFor some quick and dirty monitoring, I like to put this in a loop.\r\n\r\n        % while true; do es heap | sort -rnk6 | head -1; sleep 60; done\r\n        XO6c2A1D 57.3mb 60157200 123.7mb 129761280 46.4% 127.0.0.1 Junkpile\r\n        XO6c2A1D 54.7mb 57405904 123.7mb 129761280 44.2% 127.0.0.1 Junkpile\r\n        XO6c2A1D 62.7mb 65834752 123.7mb 129761280 50.7% 127.0.0.1 Junkpile\r\n        XO6c2A1D 56.9mb 59743504 123.7mb 129761280 46.0% 127.0.0.1 Junkpile\r\n        XO6c2A1D 52.1mb 54676216 123.7mb 129761280 42.1% 127.0.0.1 Junkpile\r\n        XO6c2A1D 37.1mb 38971744 123.7mb 129761280 30.0% 127.0.0.1 Junkpile\r\n        XO6c2A1D   52mb 54528424 123.7mb 129761280 42.0% 127.0.0.1 Junkpile\r\n        XO6c2A1D 46.5mb 48787064 123.7mb 129761280 37.6% 127.0.0.1 Junkpile\r\n\r\nThis can be extremely helpful during indexing, for example.  If you\r\nsee a single node showing up a lot, you might have hot shard(s) there.\r\nIf you see all the nodes regularly showing up with varying heap usage\r\npercentage, it's likely a healthy cluster with good shard\r\ndistribution.\r\n\r\nSearching has slightly different characteristics, but you can make\r\nsimilarly helpful inferences.\r\n\r\n\r\n## Ids\r\n\r\nSometimes it's helpful to retrieve the ids of all documents in an ES\r\nindex.\r\n\r\n        % es ids test -v\r\n        index type id\r\n        test doc 1\r\n        test doc 2\r\n        test doc 3\r\n        test doc 4\r\n\r\n\r\n## Shards\r\n\r\n### Node startup\r\n\r\nWe've started up three nodes where we had two before. ES decided to\r\nmove one shard to the third node.\r\n\r\n        % es shards\r\n        wiki 0 p STARTED    1160290 7.2gb 7776371641 127.0.0.1 Feline\r\n        wiki 0 r STARTED    1160290 7.2gb 7776371602 127.0.0.1 Jenkins, Abner\r\n        wiki 1 p RELOCATING 1159509 7.5gb 8116295811 127.0.0.1 Feline -> 127.0.0.1 Amphibius\r\n        wiki 1 r STARTED    1159509 7.5gb 8116295811 127.0.0.1 Jenkins, Abner\r\n\r\n### After turning on more replicas\r\n\r\nWe set `index.number_of_replicas` to `2`, so ES is creating another\r\ncopy of each primary shard.\r\n\r\n        % es shards\r\n        wiki     0 p STARTED      1160290   7.2gb 7776371641 127.0.0.1 Feline\r\n        wiki     0 r INITIALIZING       0 100.2mb  105077522 127.0.0.1 Amphibius\r\n        wiki     0 r STARTED      1160290   7.2gb 7776371602 127.0.0.1 Jenkins, Abner\r\n        wiki     1 r INITIALIZING       0 120.3mb  126157581 127.0.0.1 Feline\r\n        wiki     1 p STARTED      1159509   7.5gb 8116295811 127.0.0.1 Amphibius\r\n        wiki     1 r STARTED      1159509   7.5gb 8116295811 127.0.0.1 Jenkins, Abner\r\n\r\n### Single node filter by index, sort reverse by bytes\r\n\r\nYou can limit the results to a substring match of an index.  This\r\nfilters that output's sixth column through a descending sort.\r\n\r\n        % es shards wik | sort -rnk6\r\n        wiki 1 r STARTED 2.7gb 2980767835 276016 127.0.0.1 Namora\r\n        wiki 0 r STARTED 2.7gb 2953985585 276441 127.0.0.1 Namora\r\n        wiki 1 p STARTED 2.7gb 2909784771 276016 127.0.0.1 Android Man\r\n        wiki 0 p STARTED 2.6gb 2846741702 276441 127.0.0.1 Android Man\r\n\r\n### Normal three-node cluster operation\r\n\r\nAdd column names.\r\n\r\n        % es shards -v\r\n        index shard pri/rep state           docs size       bytes ip        node\r\n        wiki      0 p       STARTED      1160290 7.2gb 7776371641 127.0.0.1 Feline\r\n        wiki      0 r       INITIALIZING       0 3.1gb 3384641066 127.0.0.1 Amphibius\r\n        wiki      0 r       STARTED      1160290 7.2gb 7776371602 127.0.0.1 Jenkins, Abner\r\n        wiki      1 r       INITIALIZING       0 3.7gb 4029041251 127.0.0.1 Feline\r\n        wiki      1 p       STARTED      1159509 7.5gb 8116295811 127.0.0.1 Amphibius\r\n        wiki      1 r       STARTED      1159509 7.5gb 8116295811 127.0.0.1 Jenkins, Abner\r\n\r\n# Contributing\r\n\r\nes2unix is written in Clojure.  You'll need leiningen 2.0+ to build.\r\n\r\n        % make package\r\n\r\n# License\r\n\r\nThis software is licensed under the Apache 2 license, quoted below.\r\n\r\n        Copyright 2012-2013 ElasticSearch <http://www.elasticsearch.org>\r\n\r\n        Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\r\n        use this file except in compliance with the License. You may obtain a copy of\r\n        the License at\r\n\r\n            http://www.apache.org/licenses/LICENSE-2.0\r\n\r\n        Unless required by applicable law or agreed to in writing, software\r\n        distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\r\n        WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\r\n        License for the specific language governing permissions and limitations under\r\n        the License.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}